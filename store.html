<!DOCTYPE HTML>
<!--
    Spectral by HTML5 UP (modified for Union Coffee Co. Order Ahead)
-->
<html>
<head>
    <title>Union Coffee Co. - Order Ahead</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    <!-- Stripe.js (Test Mode) -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* Minimal additional styling for cart/modal */
        #cart-modal, #checkout-modal, #orders-modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.75);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: #fff;
            color: #333;
            border-radius: 1rem;
            max-width: 400px;
            width: 90vw;
            padding: 2rem;
            box-shadow: 0 1px 16px 0 #2228;
        }
        .close-modal {
            float: right; font-size: 1.4em; cursor: pointer;
        }
        .cart-btn, .orders-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 10002;
            background: #684321;
            color: #fff;
            padding: 1rem 1.2rem;
            border-radius: 50%;
            font-size: 1.2em;
            border: none;
            box-shadow: 0 2px 10px #0005;
            cursor: pointer;
        }
        .orders-btn {
            right: 90px;
            background: #326a3b;
        }
        .cart-count {
            background: #ed8936;
            color: #fff;
            font-size: 0.9em;
            border-radius: 1em;
            padding: 0.1em 0.7em;
            margin-left: 0.5em;
        }
    </style>
</head>
<body class="landing is-preload">

    <!-- Page Wrapper -->
    <div id="page-wrapper">

        <!-- Header (kept from your design) -->
        <header id="header" class="alt">
            <h1><a href="index.html">Union Coffee Co</a></h1>
            <nav id="nav">
                <ul>
                    <li class="special">
                        <a href="#menu" class="menuToggle"><span>Menu</span></a>
                        <div id="menu">
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="store.html">Store</a></li>
                                <li><a href="team.html">The Team</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- Banner (kept) -->
        <section id="banner">
            <div class="inner">
                <h2>Union Coffee Co.</h2>
                <p>Greensboro NC</p>
            </div>
            <a href="#order" class="more scrolly">Order Ahead</a>
        </section>

        <!-- ONLINE ORDER SECTION -->
        <section id="order" class="wrapper style2 special">
            <div class="inner">
                <header class="major">
                    <h2>Order Coffee & Pastries Ahead</h2>
                    <p>Beat the line! Choose your favorites, select pickup time, pay securely, and grab on the go.</p>
                </header>
                <div id="menu-list" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem;"></div>
            </div>
        </section>

        <!-- Cart, Checkout, Order History Buttons -->
        <button class="cart-btn" id="open-cart" title="View Cart">ðŸ›’ <span class="cart-count" id="cart-count">0</span></button>
        <button class="orders-btn" id="open-orders" title="Order History">ðŸ“¦</button>

        <!-- Cart Modal -->
        <div id="cart-modal">
            <div class="modal-content">
                <span class="close-modal" id="close-cart">&times;</span>
                <h3>Your Cart</h3>
                <div id="cart-items"></div>
                <hr>
                <strong>Total: $<span id="cart-total">0.00</span></strong>
                <button id="checkout-btn" style="margin-top:1em;">Checkout</button>
            </div>
        </div>

        <!-- Checkout Modal -->
        <div id="checkout-modal">
            <div class="modal-content">
                <span class="close-modal" id="close-checkout">&times;</span>
                <h3>Checkout</h3>
                <form id="checkout-form">
                    <label>Name:<br><input required type="text" id="cust-name" placeholder="Your Name"></label><br><br>
                    <label>Pickup Time:<br>
                        <select id="pickup-time" required></select>
                    </label><br><br>
                    <!-- Stripe Element will go here -->
                    <div id="stripe-card-element" style="margin-bottom:1em;"></div>
                    <div id="stripe-error" style="color:#d32;"></div>
                    <button type="submit" id="pay-btn">Pay Now</button>
                </form>
            </div>
        </div>

        <!-- Orders Modal -->
        <div id="orders-modal">
            <div class="modal-content">
                <span class="close-modal" id="close-orders">&times;</span>
                <h3>Order History</h3>
                <div id="order-history"></div>
            </div>
        </div>

        <!-- Rest of original sections (leave as-is for your design) -->
        <!-- ... (keep your "One", "Two", "Three", "CTA", "Footer" sections unchanged) ... -->

    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- Order Ahead System Logic -->
    <script>
    // --------------- CONFIG ---------------
    const MENU = [
        { id: 1, name: "Americano", desc: "Espresso + hot water", price: 3.00, img: "images/pic01.jpg" },
        { id: 2, name: "Latte", desc: "Espresso + steamed milk", price: 4.00, img: "images/pic02.jpg" },
        { id: 3, name: "Cappuccino", desc: "Rich foam & espresso", price: 4.50, img: "images/pic03.jpg" },
        { id: 4, name: "Cold Brew", desc: "Chilled, slow-steeped", price: 3.50, img: "images/pic01.jpg" },
        { id: 5, name: "Blueberry Muffin", desc: "Baked fresh daily", price: 2.50, img: "images/pic02.jpg" },
        { id: 6, name: "Croissant", desc: "Buttery, flaky", price: 2.75, img: "images/pic03.jpg" }
    ];

    const STRIPE_PUBLISHABLE_KEY = "pk_test_51NbyDeFeGZZ...YOUR_TEST_KEY_HERE..."; // <--- REPLACE with your test key!
    // --------------- UI RENDERING ---------------

    // Render Menu
    function renderMenu() {
        const $menu = document.getElementById('menu-list');
        $menu.innerHTML = '';
        MENU.forEach(item => {
            const el = document.createElement('div');
            el.style = "background:#fff; border-radius:1rem; box-shadow:0 1px 6px #3333; width:220px; padding:1.2em; display:flex; flex-direction:column; align-items:center;";
            el.innerHTML = `
                <img src="${item.img}" alt="" style="width:100px; height:100px; object-fit:cover; border-radius:0.7em;">
                <h4>${item.name}</h4>
                <div style="color:#654">${item.desc}</div>
                <strong>$${item.price.toFixed(2)}</strong>
                <button onclick="addToCart(${item.id})" style="margin-top:0.8em;">Add to Cart</button>
            `;
            $menu.appendChild(el);
        });
    }

    // Render Pickup Time options
    function renderPickupTimes() {
        const $sel = document.getElementById('pickup-time');
        $sel.innerHTML = "";
        const now = new Date();
        for (let i = 10; i <= 120; i += 10) {
            let t = new Date(now.getTime() + i*60000);
            let label = t.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            let v = t.toISOString();
            $sel.innerHTML += `<option value="${v}">${label}</option>`;
        }
    }

    // --------------- CART LOGIC ---------------
    function getCart() {
        return JSON.parse(localStorage.getItem('ucc_cart') || "[]");
    }
    function saveCart(cart) {
        localStorage.setItem('ucc_cart', JSON.stringify(cart));
        updateCartCount();
    }
    function addToCart(id) {
        let cart = getCart();
        let found = cart.find(i => i.id === id);
        if(found) found.qty++;
        else cart.push({id, qty:1});
        saveCart(cart);
        alert("Added to cart!");
    }
    function removeFromCart(id) {
        let cart = getCart();
        cart = cart.filter(i => i.id !== id);
        saveCart(cart);
        renderCart();
    }
    function changeQty(id, delta) {
        let cart = getCart();
        let found = cart.find(i => i.id === id);
        if (found) {
            found.qty += delta;
            if(found.qty < 1) removeFromCart(id);
            else saveCart(cart);
            renderCart();
        }
    }
    function updateCartCount() {
        let cart = getCart();
        document.getElementById('cart-count').innerText = cart.reduce((sum,i) => sum+i.qty, 0);
    }

    // --------------- MODALS ---------------
    function openModal(id) { document.getElementById(id).style.display = "flex"; }
    function closeModal(id) { document.getElementById(id).style.display = "none"; }
    document.getElementById('open-cart').onclick = () => { renderCart(); openModal('cart-modal'); };
    document.getElementById('close-cart').onclick = () => closeModal('cart-modal');
    document.getElementById('close-checkout').onclick = () => closeModal('checkout-modal');
    document.getElementById('open-orders').onclick = () => { renderOrders(); openModal('orders-modal'); };
    document.getElementById('close-orders').onclick = () => closeModal('orders-modal');

    // --------------- CART UI ---------------
    function renderCart() {
        let cart = getCart();
        let html = "";
        let total = 0;
        if(cart.length == 0) html = "<p>Your cart is empty.</p>";
        else {
            html = "<ul style='padding:0;'>";
            cart.forEach(item => {
                let prod = MENU.find(m=>m.id===item.id);
                total += prod.price * item.qty;
                html += `<li style="margin-bottom:0.8em;">
                    <b>${prod.name}</b> ($${prod.price.toFixed(2)})<br>
                    Qty: <button onclick="changeQty(${item.id},-1)">-</button> 
                    <span style="min-width:2em;display:inline-block;">${item.qty}</span>
                    <button onclick="changeQty(${item.id},1)">+</button>
                    <button onclick="removeFromCart(${item.id})" style="color:#a00;margin-left:1em;">Remove</button>
                </li>`;
            });
            html += "</ul>";
        }
        document.getElementById('cart-items').innerHTML = html;
        document.getElementById('cart-total').innerText = total.toFixed(2);
    }

    // --------------- CHECKOUT FLOW ---------------
    document.getElementById('checkout-btn').onclick = () => {
        renderPickupTimes();
        closeModal('cart-modal');
        openModal('checkout-modal');
        setTimeout(setupStripe, 200); // Setup Stripe Elements
    };

    // --------------- STRIPE (TEST MODE) ---------------
    let stripe, card;
    function setupStripe() {
        if (stripe && card) return; // Only initialize once
        stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
        const elements = stripe.elements();
        card = elements.create('card', {style:{base:{fontSize:'16px'}}});
        card.mount("#stripe-card-element");
    }

    document.getElementById('checkout-form').onsubmit = async function(e) {
        e.preventDefault();
        document.getElementById('pay-btn').disabled = true;
        document.getElementById('stripe-error').innerText = "";
        // Calculate amount
        let cart = getCart();
        let total = cart.reduce((sum,i) => sum + MENU.find(m=>m.id===i.id).price*i.qty,0);
        // Simulate a Stripe PaymentIntent (no backend)
        // Instead, use Stripe test card & client-only confirmation
        const {paymentMethod, error} = await stripe.createPaymentMethod({
            type: 'card',
            card: card,
            billing_details: {name: document.getElementById('cust-name').value}
        });
        if(error) {
            document.getElementById('stripe-error').innerText = error.message;
            document.getElementById('pay-btn').disabled = false;
            return;
        }
        // Simulated success
        saveOrder({
            name: document.getElementById('cust-name').value,
            time: new Date().toLocaleString(),
            pickup: new Date(document.getElementById('pickup-time').value).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            cart: cart.map(item => ({...item, ...MENU.find(m=>m.id===item.id)})),
            total: total
        });
        localStorage.removeItem('ucc_cart');
        updateCartCount();
        closeModal('checkout-modal');
        alert("Order placed! Confirmation sent to barista.");
    };

    // --------------- ORDER HISTORY ---------------
    function saveOrder(order) {
        let hist = JSON.parse(localStorage.getItem('ucc_orders') || "[]");
        hist.unshift(order);
        localStorage.setItem('ucc_orders', JSON.stringify(hist));
    }
    function renderOrders() {
        let hist = JSON.parse(localStorage.getItem('ucc_orders') || "[]");
        if(!hist.length) {
            document.getElementById('order-history').innerHTML = "<p>No orders yet.</p>";
            return;
        }
        let html = "<ul>";
        hist.forEach(ord => {
            html += `<li>
                <b>${ord.name}</b> @ ${ord.time}<br>
                Pickup: <b>${ord.pickup}</b><br>
                Items:<ul>${ord.cart.map(it=>`<li>${it.qty}x ${it.name}</li>`).join("")}</ul>
                <strong>Total: $${ord.total.toFixed(2)}</strong>
            </li><hr>`;
        });
        html += "</ul>";
        document.getElementById('order-history').innerHTML = html;
    }

    // --------------- INIT ---------------
    renderMenu();
    updateCartCount();

    </script>
</body>
</html>
